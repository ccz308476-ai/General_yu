### KSFA模块总结

#### 1. **动机**

**现有方法的问题：**
- 现有Transformer结构通常使用固定的感受野进行特征提取，忽略了不同类型地物覆盖需要不同上下文信息的事实。[2]
- 如图1(a)所示，HSI使用固定感受野可能出现误分类问题，例如将沥青误分为砖块。[2][3]
- 现有方法往往受限于网络固定且有限的感受野大小，无法动态适应特定类型地物覆盖所需的感受野。[7]

**提出模块的目的：**
- 设计KSFA（Kernel Selective Fusion Attention）模块是为了学习最优感受野，通过选择和整合多尺度特征来解决不同地物类别需要不同上下文尺度的问题。[3][7]
- 使特征提取在最优感受野内进行，涵盖空间和光谱维度，增强模型有效感知和区分各种HSI对象的能力。[3]

#### 2. **模块工作原理和核心思想**

**核心思想：**
KSFA通过构建大感受野获得充分的特征感知范围，然后结合空间-光谱选择机制自适应融合不同地物类型所需的适当感受野大小。[7]

**工作原理：**

1. **多尺度特征提取：**
   - 使用两个解耦的深度卷积（DwConv）：3×3卷积和5×5膨胀卷积（膨胀率为2）
   - 通过1×1卷积整合通道信息并统一维度，获得不同感受野的上下文特征：[7]
   ```
   U₁ = 1×1(dwc₃ₓ₃(X))
   U₂ = 1×1(dwc₅ₓ₅(dwc₃ₓ₃(X)))
   ```

2. **空间选择机制：**
   - 将不同感受野提取的特征U₁、U₂连接：U = [U₁; U₂] [7]
   - 应用通道级平均池化和最大池化捕获空间描述符
   - 通过1×1卷积和sigmoid激活函数生成空间选择掩码：[8]
   ```
   S̄ = 1×1([avg(U); max(U)])
   Sᵢ = σ(S̄ᵢ)
   ```

3. **光谱选择机制：**
   - 使用空间全局平均池化压缩特征U为光谱特征描述符
   - 通过全连接层产生更紧凑的光谱注意力特征Z [8]
   - 使用softmax操作生成光谱选择掩码：[8]
   ```
   Z = FC(GAP(U))
   C₁[j] = e^(MⱼZⱼ)/(e^(MⱼZⱼ) + e^(NⱼZⱼ))
   C₂[j] = e^(NⱼZⱼ)/(e^(MⱼZⱼ) + e^(NⱼZⱼ))
   ```

4. **特征融合：**
   - 通过矩阵乘法获得空间-光谱选择权重：W₁ = C₁ × S₁, W₂ = C₂ × S₂ [8]
   - 使用相应权重对增强特征图进行加权，然后通过卷积层组合：[8]
   ```
   S = 1×1(∑ᵢ₌₁ᴼ(Wᵢ · Uᵢ))
   X' = X · S
   ```

#### 3. **总结**

KSFA模块通过创新的空间-光谱双重选择机制，有效解决了高光谱图像分类中不同地物类型需要不同感受野的问题。该模块首先通过多尺度卷积构建充分的感受野范围，然后通过空间和光谱选择机制自适应地融合最适合特定地物类型的上下文信息。实验结果表明，空间-光谱联合选择机制比单独使用空间或光谱选择更有效，验证了该模块设计的合理性。[25] 这种设计使得DSFormer能够为不同类型的地物动态优化感受野，从而提高分类精度。